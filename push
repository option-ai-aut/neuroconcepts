#!/bin/bash
# Usage: ./push dev | test | main

TARGET=$1

if [ -z "$TARGET" ]; then
  echo "âŒ  Usage: ./push dev | test | main"
  exit 1
fi

if [[ "$TARGET" != "dev" && "$TARGET" != "test" && "$TARGET" != "main" ]]; then
  echo "âŒ  Unknown target: '$TARGET'. Use: dev | test | main"
  exit 1
fi

CURRENT=$(git branch --show-current)
STAGED=$(git status --porcelain)

# Warn if uncommitted changes
if [ -n "$STAGED" ]; then
  echo "âš ï¸  Du hast uncommitted Ã„nderungen. Erst committen!"
  git status --short
  exit 1
fi

echo "ğŸš€  Pushe '$CURRENT' â†’ '$TARGET'..."
git push origin HEAD:$TARGET

if [ $? -eq 0 ]; then
  echo ""
  echo "âœ…  Fertig! Deploy lÃ¤uft auf GitHub Actions."
  if [ "$TARGET" = "dev" ]; then
    echo "ğŸ”—  https://dev.immivo.ai"
  elif [ "$TARGET" = "test" ]; then
    echo "ğŸ”—  https://test.immivo.ai"
  elif [ "$TARGET" = "main" ]; then
    echo "ğŸ”—  https://immivo.ai  (Prod)"
  fi
  echo ""
  echo "ğŸ“Š  Status: https://github.com/option-ai-aut/neuroconcepts/actions"
else
  echo "âŒ  Push fehlgeschlagen."
fi
